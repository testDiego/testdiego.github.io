<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Primer Programa Con Stm32f0cube (Pt IV) - Diego Blog</title>
  <meta name="author" content="Diego">

  <meta name="description" content="Creacion de un primer proyecto para un micro stm32f0 utilizadno la tarjeta Nucleo-f072rb, el compilador gnu arm, openocd y la libreria STM32F0Cube de &hellip;">
  <meta name="keywords" content="tutorial,arm,linux,microcontrollers,st,stm32f0,cortex-m0,cmsis,stm32cubef0">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://testDiego.github.io/blog/2014/08/11/primer-programa-con-stm32f0cube-ii">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Diego Blog" type="application/atom+xml">

  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-cerulean.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53687731-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Diego Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
				<li >
                    <a href="/about-me">About me</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:testDiego.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Diego Blog" />
    <meta itemprop="description" content="Este blog esta dedicado a micros ARM mas concretamente del fabricante ST. Principalmente a la programacion en ambientes linux mediante herrameintas open source" />
    <meta itemprop="url" content="http://testDiego.github.io" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-11T21:13:25-07:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 11<sup>th</sup>, 2014</time>
        
           | <a href="#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://testDiego.github.io">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        Primer Programa Con Stm32f0cube (Pt IV)
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody"><p>La última parte de la serie <strong>Primer Programa</strong> en la cual abordaremos un poco más de la librería <strong>STM32F0Cube</strong>. Primero que nada una explicación de lo que contiene esta librería al descomprimir el archivo <strong>zip</strong> en el que viene, te encuentras con:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── Documentation
</span><span class='line'>├── Drivers
</span><span class='line'>├── _htmresc
</span><span class='line'>├── Middlewares
</span><span class='line'>├── package.xml
</span><span class='line'>├── Projects
</span><span class='line'>├── Release_Notes.html
</span><span class='line'>└── Utilities</span></code></pre></td></tr></table></div></figure>


<h4>Drivers</h4>

<p>Es uno de los directorios más importantes, en el encontramos el estándar <strong>CMSIS</strong> que contiene definidos los registros de los periféricos del micro así como los vectores de interrupción. Lo otro que encontramos de gran importancia es la librería de <strong>HAL drivers</strong> con las piezas de código que nos permitirán controlar los periféricos a través de funciones y macros ya bien definidos y probados.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── BSP
</span><span class='line'>├── CMSIS
</span><span class='line'>└── STM32F0xx_HAL_Driver</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h4>Middelwares</h4>

<p>Este es el segundo directorio de importancia el cual contiene librerias de codigo que nos permitiran realizar cosas mucho mas interesantes y que requieren un nivel mayor de expertis.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── ST
</span><span class='line'>│   ├── STM32_TouchSensing_Library
</span><span class='line'>│   └── STM32_USB_Device_Library
</span><span class='line'>└── Third_Party
</span><span class='line'>    ├── FatFs
</span><span class='line'>    └── FreeRTOS</span></code></pre></td></tr></table></div></figure>


<h4>Projects</h4>

<p>Aqui no encontrarás piezas de código reusables, solo unos cuantos ejemplos en los que se usa la librería para algunas tarjetas que están en el mercado entre las cuales encontramos la <strong>Nucleo-f072rb</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── STM32072B_EVAL
</span><span class='line'>├── STM32F0308-Discovery
</span><span class='line'>├── STM32F030R8-Nucleo
</span><span class='line'>├── STM32F072B-Discovery
</span><span class='line'>└── STM32F072RB-Nucleo</span></code></pre></td></tr></table></div></figure>


<p>El resto de los directorios son documentación y alguna utileria para actualizar la propia librería.</p>

<h2>Proyecto Recomendado por ST</h2>

<p>En la <a href="http://testdiego.github.io/blog/2014/08/10/primer-programa-con-stm32f0cube/"><strong>tercera parte</strong></a> de esta serie de post utilizamos las funciones que vienen con esta librería, si bien nuestro programa corrió exitosamente el codigo no esta ordenado de la forma que <strong>ST</strong> nos recomendaría si estamos usando <strong>STM32F0Cube</strong>. Así que lo correcto seria lo siguiente.</p>

<p>De nueva cuenta crea una nueva carpeta para nuestro proyecto</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/test_f072_cubeII</span></code></pre></td></tr></table></div></figure>


<p>Y al igual que en los anteriores deberás copiar a la carpeta de tu proyecto el archivo <strong>linker</strong>. Recuerda lo obtienes de la librería de <strong>ST</strong> en la siguiente ruta</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/TrueSTUDIO/STM32F072RB-Nucleo/STM32F072RB_FLASH.ld</span></code></pre></td></tr></table></div></figure>


<p>Bien, <strong>ST</strong> nos sugiere que ordenemos nuestro proyecto en dos directorios, uno donde iran los archivos headers ( <em>*.h</em> ) <strong>Inc</strong> y otro con los archivos fuente ( <em><em>.s y </em>.c</em> ) <strong>Src</strong>, asi que creamos estos directorios en nuestro proyecto.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/test_f072_cubeII/Inc
</span><span class='line'>$ mkdir ~/test_f072_cubeII/Src</span></code></pre></td></tr></table></div></figure>


<p>Los archivos que deberán ir en cada uno de los directorios los podremos crear desde cero o copiarlos de un lugar donde ya están escritos, como un template que viene en la librería.</p>

<p>Copia los siguientes archivos de la siguiente ruta en el directorio <strong>Inc</strong> de tu proyecto</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Inc/main.h
</span><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Inc/stm32f0xx_hal_conf.h
</span><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Inc/stm32f0xx_it.h</span></code></pre></td></tr></table></div></figure>


<p>Y aqui la descripcion de cada uno de esos archivos</p>

<ul>
<li><strong>main.h.-</strong>Aquí colocaras las funciones, variables y/o macros que tengan carácter global y que deben referenciar otros archivos de tu programa</li>
<li><strong>stm32f0xx_hal_conf.h.-</strong> Viejo conocido en donde configuras lo que se use y lo que no se use de la librería STM32F0Cube</li>
<li><strong>stm32f0xx_it.h.-</strong> Aquí colocaras los prototipos de las funciones que actúan como vectores de interrupción</li>
</ul>


<p>Copia los siguientes archivos de la siguiente ruta en el directorio Src de tu proyecto</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Src/main.c
</span><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Inc/stm32f0xx_hal_msp.c
</span><span class='line'>STM32Cube_FW_F0_V1.0.0/Projects/STM32F072RB-Nucleo/Templates/Inc/stm32f0xx_it.c</span></code></pre></td></tr></table></div></figure>


<p>Y aqui la descripcion de cada uno de los archivos</p>

<ul>
<li><strong>main.c.-</strong> Aqui va tu aplicación. Ya contiene algunas líneas de código que ST te sugiere que tenga por default</li>
<li><strong>stm32f0xx_hal_msp.c.-</strong> En este archivo colocaras las funciones callback que ocupes de la librería con código específico de tu aplicación</li>
<li><strong>stm32f0xx_it.c.-</strong> Aqui van los vectores de interrupción y donde típicamente mandas llamar las funciones que se necesiten ejecutar en una interrupción</li>
<li><strong>system_stm32f0xx.c.-</strong> Aqui se encuentra las configuraciones inciales de los reloj del sistema ( <em>ya no ocuparas hacerle cambios</em> )</li>
</ul>


<p>Tenemos que hacer una pequeña modificación en el archivo <strong>main.h</strong> para que nuestro proyecto no quede tan dependiente de la tarjeta <strong>Nucleo-f072rb</strong> y que quede más genérico. Abre el archivo con tu editor de texto favorito y sustituyes la <strong>línea 44</strong> por la siguiente</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'>main.h</h3></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &quot;stm32f0xx.h&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Abre el archivo <strong>main.c</strong> con tu editor de texto, podras observar bastante código ya escrito así como unos voluminosos comentarios escritos por los ingenieros de <strong>ST</strong>. No te asustes, si observamos la función main podras ver que se manda llamar la funcion ya conocida <code>HAL_Init()</code> y una nueva <code>SystemClock_Config()</code>, esta funcion cuyo cuerpo encuentras lineas mas abajo configura el reloj del sistema para uqe corra a 48MHz ( <em>velocidad maxima del micro</em> ) usando las funciones del periferico <strong>RCC</strong>.</p>

<p>Inserta la siguiente declaracion en la <strong>linea 53</strong></p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'>main.c </h3></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* Private variables ---------------------------------------------------------*/</span>
</span><span class='line'><span class="k">static</span> <span class="n">GPIO_InitTypeDef</span>  <span class="n">GPIO_InitStruct</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Private function prototypes -----------------------------------------------*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>A partir de la línea  <strong>84</strong> colocaremos nuestro código y dentro del ciclo while infinito también</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'>main.c </h3></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>    <span class="cm">/* -1- Enable each GPIO Clock (to be able to program the configuration registers) */</span>
</span><span class='line'>    <span class="n">__GPIOA_CLK_ENABLE</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* -2- Configure IOs in output push-pull mode to drive external LEDs */</span>
</span><span class='line'>    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Mode</span>  <span class="o">=</span> <span class="n">GPIO_MODE_OUTPUT_PP</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Pull</span>  <span class="o">=</span> <span class="n">GPIO_PULLUP</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Speed</span> <span class="o">=</span> <span class="n">GPIO_SPEED_HIGH</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">Pin</span>   <span class="o">=</span> <span class="n">GPIO_PIN_5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">HAL_GPIO_Init</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* -3- Toggle IOs in an infinite loop */</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">GPIO_PIN_5</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/* Insert delay 100 ms */</span>
</span><span class='line'>        <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si eres observador notarás que la función <code>void SysTick_Handler(void)</code> ya no se encuentra en el archivo main.c. Como esta función es un vector de interrupción ahora se encuentra en el archivo <strong>stm32f0xx_it.c</strong> ( <em>linea 109</em> ).</p>

<p>Al directorio de tu proyecto le hace falta algo ( <em>no es el makefile</em> ) y es la libreria <strong>STM32F0Cube</strong> podemos copiarla al folder de tu proyecto como en el anterior post, nada mas te recuerdo que pesa <strong>82.3 MB</strong>.</p>

<p>La librería no está diseñada para la copies en cuanto proyecto trabajes, sino más bien la dejes en un lugar fijo y referencies sus directorios desde ese mismo lugar para todos tus proyectos.</p>

<p>Puedes dejarla en donde sea que la hayas descomprimido, pero que tal si las dejas en un lugar muy estándar de linux, tu home directory ( <strong>~ </strong> ), de tal manera que tu libreria tendría el siguiente destino. Esto ayudará mucho a la portabilidad de tus proyectos.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/STM32Cube_FW_F0_V1.0.0</span></code></pre></td></tr></table></div></figure>


<p>Por último, el archivo makefile para que make realice la compilación.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch test_f072_cubeII/makefile</span></code></pre></td></tr></table></div></figure>


<p>Abre el archivo en tu editor de texto y escribe el siguiente código. Recuerda usar TABs y no espacios para las indentación.</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'>makefile </h3></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='makefile'><span class='line'><span class="nv">PROJECT</span> <span class="o">=</span> <span class="nb">test</span>
</span><span class='line'>
</span><span class='line'><span class="c"># archivos a compilar</span>
</span><span class='line'><span class="nv">FILES</span> <span class="o">=</span> main.o startup_stm32f072xb.o system_stm32f0xx.o stm32f0xx_it.o<span class="se">\</span>
</span><span class='line'>stm32f0xx_hal.o <span class="se">\</span>
</span><span class='line'>stm32f0xx_hal_rcc.o stm32f0xx_hal_rcc_ex.o <span class="se">\</span>
</span><span class='line'>stm32f0xx_hal_gpio.o <span class="se">\</span>
</span><span class='line'>stm32f0xx_hal_cortex.o <span class="se">\</span>
</span><span class='line'><span class="err">stm32f0xx_hal_flash.o</span>
</span><span class='line'>
</span><span class='line'><span class="c"># definiciones de control</span>
</span><span class='line'><span class="nv">DEFINES</span> <span class="o">=</span> -DSTM32F072xB -DUSE_HAL_DRIVER
</span><span class='line'>
</span><span class='line'><span class="c"># directorios con archivos fuente (*.c y *.s)</span>
</span><span class='line'><span class="nv">VPATH</span> <span class="o">=</span> Src <span class="se">\</span>
</span><span class='line'><span class="err">/home/diego/STM32Cube_FW_F0_V1.0.0/Drivers/STM32F0xx_HAL_Driver/Src</span>
</span><span class='line'>
</span><span class='line'><span class="c"># directorios con archivos headers (*.h)</span>
</span><span class='line'><span class="nv">INCLUDE</span> <span class="o">=</span> -I ./ <span class="se">\</span>
</span><span class='line'>-I ./Inc <span class="se">\</span>
</span><span class='line'>-I ~/STM32Cube_FW_F0_V1.0.0/Drivers/STM32F0xx_HAL_Driver/Inc <span class="se">\</span>
</span><span class='line'>-I ~/STM32Cube_FW_F0_V1.0.0/Drivers/CMSIS/Device/ST/STM32F0xx/Include <span class="se">\</span>
</span><span class='line'><span class="err">-I</span> <span class="err">~/STM32Cube_FW_F0_V1.0.0/Drivers/CMSIS/Include</span>
</span><span class='line'>
</span><span class='line'><span class="c"># a partir de aquí no modifiques nada a menos que sepas lo que haces</span>
</span><span class='line'><span class="c"># linker script to be use</span>
</span><span class='line'><span class="nv">LINKERFILE</span> <span class="o">=</span> STM32F072RB_FLASH.ld
</span><span class='line'><span class="nv">CPU</span> <span class="o">=</span> -mcpu<span class="o">=</span>cortex-m0 -mthumb -mlittle-endian
</span><span class='line'>
</span><span class='line'><span class="nv">AS</span> <span class="o">=</span> arm-none-eabi-as
</span><span class='line'><span class="nv">CC</span> <span class="o">=</span> arm-none-eabi-gcc
</span><span class='line'><span class="nv">LD</span> <span class="o">=</span> arm-none-eabi-gcc
</span><span class='line'><span class="nv">OD</span> <span class="o">=</span> arm-none-eabi-objdump
</span><span class='line'><span class="nv">OC</span> <span class="o">=</span> arm-none-eabi-objcopy
</span><span class='line'>
</span><span class='line'><span class="nv">CCFLAGS</span> <span class="o">=</span> <span class="k">$(</span>CPU<span class="k">)</span> <span class="k">$(</span>DEFINES<span class="k">)</span> <span class="k">$(</span>INCLUDE<span class="k">)</span> -Wall -fno-common -O0 -fomit-frame-pointer -Wstrict-prototypes -fverbose-asm
</span><span class='line'><span class="nv">ASFLAGS</span> <span class="o">=</span> <span class="k">$(</span>CPU<span class="k">)</span>
</span><span class='line'><span class="nv">LDFLAGS</span> <span class="o">=</span> <span class="k">$(</span>CPU<span class="k">)</span> -Wl,--gc-sections
</span><span class='line'><span class="nv">OCFLAGS</span> <span class="o">=</span> -Oihex
</span><span class='line'><span class="nv">ODFLAGS</span> <span class="o">=</span> -S
</span><span class='line'>
</span><span class='line'><span class="nf">all </span><span class="o">:</span> <span class="n">test</span>
</span><span class='line'>
</span><span class='line'><span class="nf">test </span><span class="o">:</span> <span class="k">$(</span><span class="nv">PROJECT</span><span class="k">)</span>.<span class="n">elf</span>
</span><span class='line'>    <span class="k">$(</span>OC<span class="k">)</span> <span class="k">$(</span>OCFLAGS<span class="k">)</span> <span class="k">$(</span>PROJECT<span class="k">)</span>.elf <span class="k">$(</span>PROJECT<span class="k">)</span>.hex
</span><span class='line'>    <span class="k">$(</span>OD<span class="k">)</span> <span class="k">$(</span>ODFLAGS<span class="k">)</span> <span class="k">$(</span>PROJECT<span class="k">)</span>.elf &gt; <span class="k">$(</span>PROJECT<span class="k">)</span>.lst
</span><span class='line'>    mv *.o *.elf *.hex *.lst Output
</span><span class='line'>
</span><span class='line'><span class="nf">$(PROJECT).elf </span><span class="o">:</span> <span class="k">$(</span><span class="nv">FILES</span><span class="k">)</span>
</span><span class='line'>    <span class="k">$(</span>LD<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> -T<span class="k">$(</span>LINKERFILE<span class="k">)</span> -o <span class="nv">$@</span> <span class="nv">$^</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Compile C source files</span>
</span><span class='line'><span class="nf">%.o </span><span class="o">:</span> %.<span class="n">c</span>
</span><span class='line'>    <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CCFLAGS<span class="k">)</span> -c -g -o <span class="nv">$@</span> <span class="nv">$^</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Compile ASM files</span>
</span><span class='line'><span class="nf">%.o </span><span class="o">:</span> %.<span class="n">s</span>
</span><span class='line'>    <span class="k">$(</span>AS<span class="k">)</span> <span class="k">$(</span>ASFLAGS<span class="k">)</span> -o <span class="nv">$@</span> <span class="nv">$^</span>
</span><span class='line'>
</span><span class='line'><span class="nf">clean </span><span class="o">:</span>
</span><span class='line'>    rm Output/*.*
</span></code></pre></td></tr></table></div></figure>


<p>Fijate que ahora direccionamos los directorios de la librería desde su nuevo destino que seria tu directorio de usuario <strong>ST</strong>.</p>

<p>A compilar se ha dicho</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/test_f072_cubeII
</span><span class='line'>$ make</span></code></pre></td></tr></table></div></figure>


<p>Si la terminal no arrojo ningun error deberemos tener nuestro archivo <strong>test.hex</strong> en la carpeta Output</p>

<h2>A Programar se ha dicho</h2>

<p>Abre una nueva terminal y conectate con tu tarjeta usando OpenOCD</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/test_f072_cubeII  #Recomendacion, siempre estar en el directorio de tu proyecto
</span><span class='line'>$ sudo openocd -f interface/stlink-v2-1.cfg -f target/stm32f0x_stlink.cfg</span></code></pre></td></tr></table></div></figure>


<p>En la terminal anterior madaremos nuestro programa compilado a nuestra tarjeta usando <strong>telnet</strong>, conectate al puerto <strong>4444</strong> de la siguiente manera</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/test_f072_cubeII #Recomendacion, siempre estar en el directorio de tu proyecto
</span><span class='line'>$ telnet localhost 4444</span></code></pre></td></tr></table></div></figure>


<p>Si te acepta la conexion, solo restara mandar el archivo <strong>.hex</strong>. Escribe los siguientes comandos en orden</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>reset halt
</span><span class='line'>flash write_image erase Output/test.hex
</span><span class='line'>reset run</span></code></pre></td></tr></table></div></figure>


<p>El primer comando resetea y detiene al micro, el segundo manda el programa y lo escribe en la memoria y el último lo resetea y pone a correr el programa, asi que ya podras ver un feliz led parpadeando.</p>

<h2>Conclusion</h2>

<p>Bastantes archivos y codigo para un simple parpadeo de un led te estarás diciendo. Tienes razon pero piensa que la librería y sobre todos el ordenar tu proyecto de esta manera esta pensando para que realices desde pequeños hasta grandes proyectos con una gran cantidad de código y archivos fuente y es en estos último cuando adquiere gran importancia ordenar bien tu código.</p>

<p>Un punto muy importante que <strong>ST</strong> maneja una herramienta que permite configurar la librería <strong>STM32F0Cube</strong> y generar código a partir de una <a href="http://www.st.com/web/en/catalog/tools/PF259242"><strong>interfaz gráfica</strong></a>. dicha interfaz gráfica necesitará que tu proyecto lo tengas ordenado de esta manera.</p>

<p>Para terminar te dejamos la estructura del directorio de tu proyecto</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── Inc
</span><span class='line'>│   ├── main.h
</span><span class='line'>│   ├── stm32f0xx_hal_conf.h
</span><span class='line'>│   └── stm32f0xx_it.h
</span><span class='line'>├── makefile
</span><span class='line'>├── Output/
</span><span class='line'>├── Src
</span><span class='line'>│   ├── main.c
</span><span class='line'>│   ├── stm32f0xx_hal_msp.c
</span><span class='line'>│   ├── stm32f0xx_it.c
</span><span class='line'>│   └── system_stm32f0xx.c
</span><span class='line'>├── startup_stm32f072xb.s
</span><span class='line'>└── STM32F072RB_FLASH.ld</span></code></pre></td></tr></table></div></figure>

</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Posted by <span class="fn" itemprop="name">Diego</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-11T21:13:25-07:00"  data-updated="true" itemprop="datePublished dateCreated">Aug 11<sup>th</sup>, 2014</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/stm32f0/'>stm32f0</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://testDiego.github.io/blog/2014/08/11/primer-programa-con-stm32f0cube-ii/" data-via="DiegoMX84" data-counturl="http://testDiego.github.io/blog/2014/08/11/primer-programa-con-stm32f0cube-ii/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2014/08/10/primer-programa-con-stm32f0cube/" title="Previous Post: Primer Programa con STM32F0Cube (pt III)">&laquo; Primer Programa con STM32F0Cube (pt III)</a></li>
            
            
            <li class="next"><a href="/blog/2014/08/13/programando-con-openocd/" title="Next Post: Programando con OpenOCD">Programando con OpenOCD &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2014/08/14/debugging-con-openocd-y-gdb/">Debugging Con OpenOCD Y GDB</a>
    
    <a class="list-group-item " href="/blog/2014/08/13/programando-con-openocd/">Programando Con OpenOCD</a>
    
    <a class="list-group-item active" href="/blog/2014/08/11/primer-programa-con-stm32f0cube-ii/">Primer Programa Con Stm32f0cube (Pt IV)</a>
    
    <a class="list-group-item " href="/blog/2014/08/10/primer-programa-con-stm32f0cube/">Primer Programa Con STM32F0Cube (Pt III)</a>
    
    <a class="list-group-item " href="/blog/2014/08/08/primer-programa-cmsis/">Primer Programa CMSIS (Pt II)</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/arm-tools/index.html">
        <span class="badge">4</span>
        arm tools
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/stm32f0/index.html">
        <span class="badge">4</span>
        stm32f0
      </a>
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating...</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/testDiego">@testDiego</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'testDiego',
            count: 2,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Diego<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'elDiego84';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://testDiego.github.io/blog/2014/08/11/primer-programa-con-stm32f0cube-ii/';
        var disqus_url = 'http://testDiego.github.io/blog/2014/08/11/primer-programa-con-stm32f0cube-ii/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


  </body>
</html>
